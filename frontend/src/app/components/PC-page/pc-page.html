<main>
  <section class="details">
    <a (click)="toMain()" class="back-btn">‚Üê Go Back</a>
    <h2>Device Details</h2>

    <div class="image">
      <img src="/laptop.png" alt="Laptop" />
    </div>

    <table>
      <thead>
        <tr>
          <th>IP Address</th>
          <th>MAC</th>
          <th>Hostname</th>
          <th>OS Match</th>
          <th>Ports</th>
          <th>Protocol</th>
          <th>Issues</th>
          <th>Password Status</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let dev of pcData$ | async"
          [class.has-issues]="
            dev.security_analysis && dev.security_analysis.total_issues > 0
          "
        >
          <td>{{ dev.ip }}</td>
          <td>{{ dev.mac }}</td>
          <td>{{ dev.hostname }}</td>
          <td>
            <span *ngFor="let os of dev.os; let last = last">
              {{ os.os_match }} ({{ os.accuracy }}<span>%</span>)
              {{ last ? "" : ", " }}
            </span>
          </td>
          <td>
            <span *ngFor="let port of dev.ports; let last = last">
              {{ port.port }} {{ last ? "" : ", " }}
            </span>
          </td>
          <td>
            <span *ngFor="let port of dev.ports; let last = last">
              {{ port.service }} {{ last ? "" : ", " }}
            </span>
          </td>
          <td>
            <div class="issues-container" *ngIf="dev.security_analysis">
              <span class="risk-score"
                >Risk: {{ dev.security_analysis.risk_score }}/100</span
              >
              <br />
              <span class="issues-count"
                >{{ dev.security_analysis.total_issues }} issues</span
              >
            </div>
          </td>
          <td>
            <span
              *ngIf="dev.password_security"
              [ngClass]="{
                'status-safe': dev.password_security.status === 'password_safe',
                'status-unsafe':
                  dev.password_security.status === 'default_password_unsafe',
                'status-unknown': dev.password_security.status === 'unknown'
              }"
              class="password-status"
            >
              <span *ngIf="dev.password_security.status === 'password_safe'"
                >‚úÖ Safe</span
              >
              <span
                *ngIf="
                  dev.password_security.status === 'default_password_unsafe'
                "
                >üö® Unsafe</span
              >
              <span *ngIf="dev.password_security.status === 'unknown'"
                >‚ùì Unknown</span
              >
              <span
                *ngIf="
                  dev.password_security.status !== 'password_safe' &&
                  dev.password_security.status !== 'default_password_unsafe' &&
                  dev.password_security.status !== 'unknown'
                "
              >
                {{ dev.password_security.status }}
              </span>
            </span>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
</main>
