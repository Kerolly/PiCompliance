<main>
  <section class="details">
    <a (click)="toMain()" class="back-btn">‚Üê Go Back</a>
    <h2>Device Details</h2>

    <div class="image">
      <img src="/tv.png" alt="Smart TV" />
    </div>

    <table>
      <thead>
        <tr>
          <th>IP Address</th>
          <th>MAC</th>
          <th>Hostname</th>
          <th>Ports Opened</th>
          <th>Vuln. Proto.</th>
          <th>Issues</th>
          <th>Password Status</th>
        </tr>
      </thead>
      <tbody>
        <tr
          *ngFor="let dev of othersData$ | async"
          [class.has-issues]="
            dev.security_analysis && dev.security_analysis.total_issues > 0
          "
        >
          <td>{{ dev.ip }}</td>
          <td>{{ dev.mac }}</td>
          <td>{{ dev.hostname || dev.ip }}</td>
          <td>
            <span *ngIf="dev.ports && dev.ports.length > 0; else noPorts">
              <span *ngFor="let port of dev.ports; let last = last">
                {{ port.port === "Unknown" ? "None" : port.port
                }}{{ last ? "" : ", " }}
              </span>
            </span>
            <ng-template #noPorts>
              <span>None</span>
            </ng-template>
          </td>
          <td>
            <span *ngIf="dev.ports && dev.ports.length > 0; else noServices">
              <span *ngFor="let port of dev.ports; let last = last">
                {{ port.service === "Unknown" ? "None" : port.service
                }}{{ last ? "" : ", " }}
              </span>
            </span>
            <ng-template #noServices>
              <span>None</span>
            </ng-template>
          </td>
          <td>
            <div class="issues-container" *ngIf="dev.security_analysis">
              <span class="risk-score"
                >Risk: {{ dev.security_analysis.risk_score }}/100</span
              >
              <br />
              <span class="issues-count"
                >{{ dev.security_analysis.total_issues }} issues</span
              >
            </div>
            <span *ngIf="!dev.security_analysis">None</span>
          </td>
          <td>
            <span
              *ngIf="dev.password_security"
              [ngClass]="{
                'status-safe': dev.password_security.status === 'password_safe',
                'status-unsafe':
                  dev.password_security.status === 'default_password_unsafe',
                'status-unknown': dev.password_security.status === 'unknown'
              }"
              class="password-status"
            >
              <span *ngIf="dev.password_security.status === 'password_safe'"
                >‚úÖ Safe</span
              >
              <span
                *ngIf="
                  dev.password_security.status === 'default_password_unsafe'
                "
                >üö® Unsafe</span
              >
              <span *ngIf="dev.password_security.status === 'unknown'"
                >‚ùì None</span
              >
              <span
                *ngIf="
                  dev.password_security.status !== 'password_safe' &&
                  dev.password_security.status !== 'default_password_unsafe' &&
                  dev.password_security.status !== 'unknown'
                "
              >
                {{ dev.password_security.status }}
              </span>
            </span>
            <span *ngIf="!dev.password_security">None</span>
          </td>
        </tr>
      </tbody>
    </table>
  </section>
</main>
